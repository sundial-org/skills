# Sundial CLI Integration Tests

ðŸš§ Warning: these tests were auto-generated by Claude Code.

This directory contains bash-based integration tests for the Sundial CLI (`sun`).

## Prerequisites

Before running tests, build the CLI:

```bash
cd cli
npm run build
```

## Running Tests

Run all tests:

```bash
./test/run-all.sh
```

Or run `npm test` from the `cli/` directory.

Run individual tests:

```bash
./test/test-add-remove.sh
./test/test-config.sh
./test/test-show.sh
./test/test-fuzzy-match.sh
```

## Test Files

| File | Description |
|------|-------------|
| `run-all.sh` | Master test runner - runs all tests and reports results |
| `test-add-remove.sh` | Tests `sun add` and `sun remove` commands |
| `test-config.sh` | Tests configuration management |
| `test-show.sh` | Tests `sun show` command |
| `test-fuzzy-match.sh` | Tests typo suggestions for misspelled commands |

## Test Output

All tests log their output to the `logs/` directory:

- `logs/add-remove.log`
- `logs/config.log`
- `logs/show.log`
- `logs/fuzzy-match.log`

These logs contain the full CLI output and PASS/FAIL assertions for each test case.

## Test Structure

Each test script:

1. Creates isolated temp directories for `HOME` and working directory
2. Sets up any required config files
3. Runs CLI commands and captures output
4. Asserts on directory structure (folders exist/don't exist)
5. Asserts on CLI output (contains expected strings)
6. Cleans up temp directories on exit

## What's Tested

### test-add-remove.sh

- **Local folder**: Add skill from local path
- **Multi-skills**: Add multiple skills from parent directory
- **Git**: Add skills from git repository (network dependent)
- **Shortcuts**: Add skills via registry shortcuts (registry dependent)
- **Local vs Global**: `--global` flag behavior
- **Agent tags**: `--claude`, `--codex`, `--gemini` flags
- **Remove**: Remove from single and multiple agents

### test-config.sh

- Config directory creation (`~/.sun/`)
- Config file parsing
- Default agents affect `add` command behavior
- Explicit flags override config defaults

### test-show.sh

- Show with no agent folders
- Show with empty agent folder
- Show with installed skills
- Show specific skill details
- Show skill in multiple locations (local + global)
- Show non-existent skill error

### test-fuzzy-match.sh

- Typo suggestions: `ad` â†’ `add`, `remov` â†’ `remove`, etc.
- "Did you mean" messages
- Valid commands list displayed
- Non-zero exit code for unknown commands

## Fixtures

Test fixtures are in `fixtures/`:

```
fixtures/
â”œâ”€â”€ sample-skill/
â”‚   â””â”€â”€ SKILL.md          # Single test skill
â””â”€â”€ multi-skills/
    â”œâ”€â”€ skill-one/
    â”‚   â””â”€â”€ SKILL.md      # First skill in multi-skill dir
    â””â”€â”€ skill-two/
        â””â”€â”€ SKILL.md      # Second skill in multi-skill dir
```

## Adding New Tests

1. Create a new `test-*.sh` file
2. Add header documentation following the existing pattern
3. Use the helper functions: `log()`, `assert_dir_exists()`, `assert_output_contains()`
4. Add cleanup trap: `trap cleanup EXIT`
5. Add the test to the `TESTS` array in `run-all.sh`
